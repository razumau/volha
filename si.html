<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Кубок княгини Ольги</title>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/PT+Sans:400,700,400i">
    <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/Alegreya+Sans:400,700,400i">
    <script type="text/javascript">

          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-43833229-2']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();

    </script>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8 col-md-offset-3 title">
            кубок княгини Ольги</div>
    </div>
    <div class="row">
        <ul class="col-md-2 col-md-offset-3 nav nav-pills nav-stacked">
            <li>
                <a href="./index.html">расписание</a>
            <li>
                <a href="./map.html">карта</a>
            <li>
                <a href="./chgk.html" data-no-instant>результаты <span class='caps'>чгк</span></a>
            <li class='active'>
                <a href="./si.html" data-no-instant>результаты <span class='caps'>си</span></a>
            <li>
                <a href="./si.html" data-no-instant>результаты <span class='caps'>эк</span></a>
            <li>    
                <a href="./regulations.html">регламент</a>
            <li>
                <a href="./editors.html">редакторы</a>
            <li>   
                <a href="./hotels.html" data-no-instant>гостиницы</a>
            <li>
                <a href="./list.html" data-no-instant>команды</a>
        </ul>
        <div class="col-md-6 main">
            <table class='table teams' id='mainTable'>
                <tr>
                    <th>#</th>
                    <th>команда</th>
                    <th>сумма</th>
                    <th>ответов за <span class='figure'>50</span></th>
                </tr>
            </table>
            
            
    </div> 
</div>
</div>      
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src='./js/tabletop.js'></script>
<script src='./js/spin.min.js'></script>
<script src="./js/instantclick.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
<script type="text/javascript">

    var spinner = new Spinner().spin();
    $('#mainTable').append(spinner.el);

    window.onload =  function() { init() };


    var public_spreadsheet_url = 'https://docs.google.com/spreadsheet/pub?hl=en_US&hl=en_US&key=1fKt2k8ffYXlK0T5S6Ne2EDmdV2gE15TKF7D--j5xKI4&output=html';

    function init() {

        Tabletop.init( { key: public_spreadsheet_url,
                         callback: createTable,
                         simpleSheet: true } )
    }

    function addToTable (table, v, number) {

        table.push('<tr><td class="figure">');
        table.push((number).toString());
        table.push('</td><td>');
        table.push(v['команда']);
        table.push('</td><td class="figure">');
        table.push(v['сумма']);
        table.push('</td><td class="figure">');
        table.push(v['ответы за 50']);
        table.push('</td>');
        table.push('</tr>');
    }

    function createTable (data, tabletop) {
        var mainTable = [], 
            mainCount = 1;
            
        data.sort(function (a, b) {
           var result = a['сумма'] - b['сумма'];
           if (result === 0){
               return a['ответы за 50'] - b['ответы за 50'];
           } else {
               return result;
           }
        });

        data.forEach (function (v, index){                
            addToTable(mainTable, v, mainCount);
        });
        
        $('table').css("visibility", "visible");
        $('#mainTable').append(mainTable.join(''));
        spinner.stop();
    }

</script>
</body>
</html>
